### IntelliJ IDEA 运行 Spring Boot 项目时涉及 Java 版本的点总结

基于您提供的错误日志（Spring Boot 2.6.13 与 JDK 21 的 class file version 65 不兼容，导致 ASM 解析失败）、之前的对话（诊断为 Spring Framework 5.3.x 的 ASM 版本不支持 Java 21，推荐升级 Spring Boot 或降级 JDK）、以及您分享的 ChatGPT 链接（该链接讨论了 IntelliJ IDEA 中的 JDK 版本警告问题，包括项目 SDK 设置、字节码版本不匹配的警告，以及如何通过 Project Structure 配置正确 JDK 来避免编译/运行时异常；不过内容提取有限，主要强调检查 Gradle/Maven 插件与 JDK 一致性），我全面总结了在 IDEA 中运行 Spring Boot 项目时**可能涉及 Java 版本的痛点**。

这些点覆盖了**开发、编译、运行、依赖兼容**的全链路，通常源于“编译时 JDK”、“运行时 JDK”、“项目配置 JDK”不一致，或框架/工具不支持目标 Java 版本。Spring Boot 项目特别敏感，因为它依赖 Spring Framework 的 ASM（字节码操作库），ASM 版本直接受 Java class file major version 影响（e.g., Java 8=52, Java 17=61, Java 21=65）。

我将它们分类，便于排查。全列表基于常见场景（从新手配置到高级兼容），共 **12 个主要点**（按流程排序）。每个点包括**触发场景**、**症状**、**检查/修复步骤**，并标注**优先级**（高/中/低，根据频率）。

#### 1. **项目 SDK 配置不匹配**（优先级：高）
- **场景**：IDEA 项目根目录的 JDK 设置与实际安装不符，导致编译用错版本。
- **症状**：编译警告如 "Target bytecode version 17 < Java version 21"（如 ChatGPT 链接所述），或运行时报 "Unsupported class file version"。
- **检查/修复**：
    - 打开 **File > Project Structure > Project**，确保 **Project SDK** 为目标 JDK（e.g., JDK 21）。
    - **Module** 页签下，**Language level** 设置为对应版本（e.g., 21）。
    - 重启 IDEA，运行 `mvn clean compile` 测试。

#### 2. **模块 Language Level 不一致**（优先级：高）
- **场景**：多模块项目中，某个模块的 Java 版本低于/高于项目级。
- **症状**：部分类编译失败，或字节码版本警告（e.g., major version 65 vs. 61）。
- **检查/修复**：
    - **Project Structure > Modules > Sources**，统一 **Language level** 为 e.g., "21 - Lambdas, switch expressions"。
    - 在 `pom.xml`（Maven）或 `build.gradle`（Gradle）中添加：
      ```xml
      <properties>
          <java.version>21</java.version>
          <maven.compiler.source>21</maven.compiler.source>
          <maven.compiler.target>21</maven.compiler.target>
      </properties>
      ```

#### 3. **Maven/Gradle 编译器插件 JDK 版本错位**（优先级：高）
- **场景**：构建工具的 compiler 插件默认用系统 JDK，但未显式指定。
- **症状**：终端 `mvn compile` 成功，但 IDEA 运行时报 class file 版本错误（日志中常见）。
- **检查/修复**：
    - Maven：确保 `maven-compiler-plugin` 版本 >=3.11（支持 Java 21），配置如上。
    - Gradle：`java { toolchain { languageVersion = JavaLanguageVersion.of(21) } }`。
    - 在 IDEA **Settings > Build > Build Tools > Maven/Gradle**，设置 **JDK for importer** 为正确版本。

#### 4. **运行配置的 JRE 不匹配**（优先级：高）
- **场景**：IDEA 的 Run/Debug Configurations 用默认 JRE，而非项目 JDK。
- **症状**：启动时日志显示 "using Java X" 但实际运行崩溃（e.g., 您的日志：Java 21 但 Spring Boot 2.6 只支持 <=17）。
- **检查/修复**：
    - 编辑 **Run/Debug Configurations > Application**，**JRE** 选 **Project SDK**（e.g., JDK 21）。
    - 全局设置：**Settings > Build > Build Tools > Runner**，默认 JRE 设为项目 JDK。

#### 5. **Spring Boot 版本与 Java 兼容性**（优先级：高）
- **场景**：Spring Boot 2.x (e.g., 2.6.13) 只支持 Java 8-17，不识 Java 21 的 class file。
- **症状**：ASM 解析失败（您的核心错误：major version 65）。
- **检查/修复**：
    - 升级到 Spring Boot 3.2+（支持 Java 21，ASM 9.6+）。
    - 或降级项目到 Java 17：修改 `spring-boot-starter-parent` 版本，并设 `<java.version>17</java.version>`。

#### 6. **ASM 库版本过旧**（优先级：中）
- **场景**：Spring Core 内置 ASM <9.5，无法解析 Java 21+ class 文件。
- **症状**：`NestedIOException: ASM ClassReader failed... Unsupported class file major version`（精确匹配您的日志）。
- **检查/修复**：
    - 随 Spring Boot 升级 ASM（3.2+ 内置支持）。
    - 临时：排除旧 ASM，引入 `org.ow2.asm:asm:9.7`，但易冲突。

#### 7. **Lombok 等注解处理器 JDK 不兼容**（优先级：中）
- **场景**：Lombok 1.18.x 默认不支持 Java 21 的新特性（如 records）。
- **症状**：编译时注解处理失败，或运行时报 NoSuchMethodError。
- **检查/修复**：
    - 升级 Lombok 到 1.18.30+（支持 Java 21）。
    - IDEA 插件：**Settings > Plugins** 更新 Lombok 插件，并启用 Annotation Processing。

#### 8. **MyBatis-Plus 等 ORM 框架兼容**（优先级：中）
- **场景**：您的依赖 MyBatis-Plus 3.5.x 在 Java 21 上可能有反射问题。
- **症状**：启动后 Mapper 扫描失败，或 SQL 执行异常。
- **检查/修复**：
    - 确认版本 >=3.5.3（支持 Java 17+），升级到 3.5.7+ 以支持 21。
    - 测试：运行单元测试，确保 `@MapperScan` 正常。

#### 9. **第三方依赖隐式 JDK 要求**（优先级：中）
- **场景**：如您的 easyexcel 3.2.1 (POI 4.1.2) 或 SpringFox 3.0.0，在 Java 21 上有序列化 bug。
- **症状**：运行时 ClassCastException 或 JSON 解析失败。
- **检查/修复**：
    - 用 `mvn dependency:tree` 检查依赖树，升级冲突库（e.g., POI 到 5.2+ 支持 Java 21）。
    - 添加 `--add-opens` VM 选项：`-Djava.security.egd=file:/dev/./urandom`（针对反射）。

#### 10. **IDEA 自身版本对 JDK 支持**（优先级：低）
    - **场景**：旧 IDEA (e.g., <2023.1) 不完全支持 Java 21 调试。
    - **症状**：调试时步进异常，或代码补全忽略新语法。
    - **检查/修复**：
      - 更新到 IDEA 2024.1+（您的日志是 2025.1.2，已支持）。
      - **Help > Check for Updates**，并重启。

#### 11. **字节码验证与 Tiered Compilation**（优先级：低）
    - **场景**：您的日志有 `-XX:TieredStopAtLevel=1`，在 Java 21 上可能与旧 Spring 冲突。
    - **症状**：JIT 编译慢，或 HotSpot 警告。
    - **检查/修复**：
      - 移除自定义 JVM args，除非必要；用默认 Tiered 模式。
      - 测试：运行无 args 启动。

#### 12. **环境变量与系统 JDK 干扰**（优先级：低）
    - **场景**：JAVA_HOME 指向旧 JDK，IDEA 继承系统环境。
    - **症状**：终端 vs. IDEA 行为不一致（e.g., `java -version` 是 17，但项目设 21）。
    - **检查/修复**：
      - 设置 `JAVA_HOME` 为 JDK 21 路径，重启终端/IDEA。
      - IDEA：**Settings > Appearance & Behavior > Path Variables**，覆盖 JAVA_HOME。

### 总体建议
- **排查顺序**：先检查 1-4（IDEA 配置），再 5（Spring Boot 升级，最彻底解决您的日志问题），最后依赖兼容。
- **测试流程**：修改后，`mvn clean package`，然后 IDEA 运行；观察日志中 "using Java X" 与 class file 版本。
- **为什么这么多点？** Spring Boot 是“约定优于配置”的框架，但 Java 版本演进快（21 引入 virtual threads 等），旧栈易碎。目标：全链路统一 Java 21 + Spring Boot 3.2+。
- 如果升级 Spring Boot，预计 1-2 天（需处理 Jakarta EE 迁移、记录类型变化）；降级到 Java 17 更快（几小时）。

如果您提供更多细节（如 pom.xml 片段或 ChatGPT 链接的完整截图），我可以给出针对性脚本/配置。