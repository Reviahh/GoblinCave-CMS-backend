import{_ as A,r as k,o as D,D as M,d as r,e as l,l as u,m as g,f as s,w as n,g as d,A as z,F as $,v as E,q as F,i as o,t as c,x as j,E as w}from"./index-LBqe1eNs.js";import{useCompetitionStore as q}from"./competition-BeX1I71u.js";import{listCompetitionRegistrations as L,reviewRegistration as U}from"./competition-DDRzTI-D.js";const H={class:"page"},Y={class:"filter-bar"},G={key:0,class:"loading-tip"},J={key:1,class:"registration-list"},K={key:0},O={key:1},P={__name:"AdminRegistrations",setup(Q){const T=M(),x=q(),v=k(!1),i=k(null),m=k([]);D(async()=>{await x.fetchList();const a=T.query.competitionId;a&&(i.value=Number(a),await y())});async function y(){if(i.value){v.value=!0;try{const e=(await L(i.value))?.data?.data;Array.isArray(e)?m.value=e:e?.list?m.value=e.list:m.value=[]}catch(a){console.error("加载报名列表失败",a),m.value=[]}finally{v.value=!1}}}function B(a){if(!a)return"";const e=new Date(a);return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()} ${e.getHours()}:${String(e.getMinutes()).padStart(2,"0")}`}function R(a){return a===1||a==="approved"?"success":a===2||a==="rejected"?"danger":"warning"}function h(a){return a===1||a==="approved"?"已通过":a===2||a==="rejected"?"已拒绝":"待审核"}async function I(a,e){const _=e===1?"通过":"拒绝";try{await j.confirm(`确定${_}队伍「${a.teamName}」的报名申请吗？`,"审核确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:e===1?"success":"warning"}),await U({registrationId:a.id,teamId:a.teamId,competitionId:i.value,status:e}),w.success(`${_}成功`),await y()}catch(f){f!=="cancel"&&(console.error("审核失败",f),w.error("审核失败："+(f?.message||"未知错误")))}}return(a,e)=>{const _=d("el-option"),f=d("el-select"),p=d("el-table-column"),b=d("el-tag"),C=d("el-button"),S=d("el-table"),N=d("el-empty");return l(),r("div",H,[e[6]||(e[6]=u("h2",null,"试炼资格审核",-1)),u("div",Y,[s(f,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=t=>i.value=t),placeholder:"选择试炼",style:{width:"300px"},onChange:y},{default:n(()=>[(l(!0),r($,null,E(F(x).competitions,t=>(l(),g(_,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),v.value?(l(),r("div",G,"加载中...")):i.value?(l(),r("div",J,[s(S,{data:m.value,style:{width:"100%"},stripe:"",border:""},{default:n(()=>[s(p,{prop:"id",label:"申请 ID",width:"80"}),s(p,{label:"类型",width:"100"},{default:n(({row:t})=>[s(b,{type:t.teamId?"success":"info",size:"small"},{default:n(()=>[o(c(t.teamId?"部落战":"独狼战"),1)]),_:2},1032,["type"])]),_:1}),s(p,{label:"挑战者信息","min-width":"200"},{default:n(({row:t})=>[t.teamId?(l(),r("div",K,[u("div",null,[e[1]||(e[1]=u("strong",null,"部落：",-1)),o(c(t.teamName||"未命名"),1)]),u("div",null,[e[2]||(e[2]=u("strong",null,"酋长：",-1)),o(c(t.userName||t.leaderName||"-"),1)])])):(l(),r("div",O,[e[3]||(e[3]=u("strong",null,"独狼：",-1)),o(c(t.userName||"-"),1)]))]),_:1}),s(p,{prop:"createTime",label:"申请时间",width:"180"},{default:n(({row:t})=>[o(c(B(t.createTime)),1)]),_:1}),s(p,{prop:"status",label:"状态",width:"100",align:"center"},{default:n(({row:t})=>[s(b,{type:R(t.status)},{default:n(()=>[o(c(h(t.status)),1)]),_:2},1032,["type"])]),_:1}),s(p,{label:"操作",width:"180",fixed:"right"},{default:n(({row:t})=>[t.status===0?(l(),r($,{key:0},[s(C,{type:"success",size:"small",onClick:V=>I(t,1)},{default:n(()=>[...e[4]||(e[4]=[o("通过",-1)])]),_:1},8,["onClick"]),s(C,{type:"danger",size:"small",onClick:V=>I(t,2)},{default:n(()=>[...e[5]||(e[5]=[o("拒绝",-1)])]),_:1},8,["onClick"])],64)):(l(),g(b,{key:1,type:t.status===1?"success":"danger",size:"small"},{default:n(()=>[o(c(h(t.status)),1)]),_:2},1032,["type"]))]),_:1})]),_:1},8,["data"]),m.value.length===0?(l(),g(N,{key:0,description:"暂无申请记录"})):z("",!0)])):(l(),g(N,{key:2,description:"请选择试炼"}))])}}},ee=A(P,[["__scopeId","data-v-5469c23b"]]);export{ee as default};
