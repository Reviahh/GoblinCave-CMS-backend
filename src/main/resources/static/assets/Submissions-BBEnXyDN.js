import{_ as Q,c as R,D as W,r as m,o as X,E as _,d as y,e as s,f as l,l as D,w as t,q as I,u as Z,g as i,m as v,A as k,i as n,a3 as ee,a6 as te,t as r}from"./index-LBqe1eNs.js";import{u as le}from"./submission-C873XoBW.js";import{useCompetitionStore as oe}from"./competition-BeX1I71u.js";import"./submission-DCFVV_C6.js";import"./competition-DDRzTI-D.js";const ae={class:"page"},ne={class:"page-header"},ie={key:0,class:"loading-tip"},se={key:1,class:"submission-list"},ue={key:1,style:{color:"#909399"}},de={key:1},re={__name:"Submissions",setup(pe){const E=W(),F=Z(),w=le(),h=oe(),b=R(()=>Number(E.params.competitionId)),S=m(!1),x=m(!1),g=m(!1),C=m(!1),u=m(null),V=m(null),$=R(()=>w.submissions),d=m({description:"",file:null});X(async()=>{if(b.value){S.value=!0;try{await w.fetchList({competitionId:b.value});const a=await h.fetchMyRegistration(b.value);a?V.value=a.id:_.warning("您尚未报名本次试炼，无法提交战利品")}finally{S.value=!1}}});function N(a){if(!a)return"";const e=new Date(a);return isNaN(e.getTime())?"":`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}function q(a){d.value.file=a.raw}function L(){_.warning("只能上传一个文件")}async function z(){if(!V.value){_.warning("您未报名该试炼，无法提交战利品");return}if(!d.value.file){_.warning("请上传文件");return}x.value=!0;try{const a={competitionId:b.value,registrationId:V.value,description:d.value.description,file:d.value.file};await w.submit(a),_.success("提交成功"),g.value=!1,d.value={description:"",file:null},await w.fetchList({competitionId:b.value})}catch(a){_.error("提交失败："+(a?.message||"未知错误"))}finally{x.value=!1}}function A(a){u.value=a,C.value=!0}function H(a){a.fileUrl&&window.open(a.fileUrl,"_blank")}return(a,e)=>{const T=i("el-icon"),p=i("el-button"),f=i("el-table-column"),M=i("el-tag"),Y=i("el-table"),j=i("el-empty"),G=i("el-input"),U=i("el-form-item"),J=i("el-upload"),K=i("el-form"),B=i("el-dialog"),c=i("el-descriptions-item"),O=i("el-descriptions");return s(),y("div",ae,[l(p,{onClick:e[0]||(e[0]=o=>I(F).back()),type:"text",class:"back-btn"},{default:t(()=>[l(T,null,{default:t(()=>[l(I(ee))]),_:1}),e[6]||(e[6]=n(" 返回试炼 ",-1))]),_:1}),D("div",ne,[e[8]||(e[8]=D("h2",null,"战利品上交",-1)),l(p,{type:"primary",onClick:e[1]||(e[1]=o=>g.value=!0)},{default:t(()=>[l(T,null,{default:t(()=>[l(I(te))]),_:1}),e[7]||(e[7]=n(" 上交战利品 ",-1))]),_:1})]),S.value?(s(),y("div",ie,"加载中...")):(s(),y("div",se,[l(Y,{data:$.value,style:{width:"100%"}},{default:t(()=>[l(f,{prop:"id",label:"ID",width:"80"}),l(f,{prop:"teamName",label:"部落名称"}),l(f,{prop:"description",label:"战利品描述","show-overflow-tooltip":""}),l(f,{prop:"createTime",label:"上交时间",width:"160"},{default:t(({row:o})=>[n(r(N(o.createTime||o.submitTime)),1)]),_:1}),l(f,{prop:"score",label:"评分",width:"100"},{default:t(({row:o})=>[o.score!=null?(s(),v(M,{key:0,type:"success"},{default:t(()=>[n(r(o.score),1)]),_:2},1024)):(s(),y("span",ue,"待萨满鉴定"))]),_:1}),l(f,{label:"操作",width:"150"},{default:t(({row:o})=>[l(p,{type:"text",onClick:P=>A(o)},{default:t(()=>[...e[9]||(e[9]=[n("查看",-1)])]),_:1},8,["onClick"]),o.fileUrl?(s(),v(p,{key:0,type:"text",onClick:P=>H(o)},{default:t(()=>[...e[10]||(e[10]=[n("下载",-1)])]),_:1},8,["onClick"])):k("",!0)]),_:1})]),_:1},8,["data"]),$.value.length===0?(s(),v(j,{key:0,description:"暂无上交"})):k("",!0)])),l(B,{modelValue:g.value,"onUpdate:modelValue":e[4]||(e[4]=o=>g.value=o),title:"上交战利品",width:"600px"},{footer:t(()=>[l(p,{onClick:e[3]||(e[3]=o=>g.value=!1)},{default:t(()=>[...e[13]||(e[13]=[n("取消",-1)])]),_:1}),l(p,{type:"primary",onClick:z,loading:x.value},{default:t(()=>[...e[14]||(e[14]=[n("提交",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(K,{model:d.value,"label-width":"100px"},{default:t(()=>[l(U,{label:"战利品描述"},{default:t(()=>[l(G,{modelValue:d.value.description,"onUpdate:modelValue":e[2]||(e[2]=o=>d.value.description=o),type:"textarea",rows:4,placeholder:"简要描述您的战利品"},null,8,["modelValue"])]),_:1}),l(U,{label:"上传战利品",required:""},{default:t(()=>[l(J,{ref:"uploadRef","auto-upload":!1,limit:1,"on-change":q,"on-exceed":L},{tip:t(()=>[...e[12]||(e[12]=[D("div",{class:"el-upload__tip"},"支持 zip、pdf、doc 等格式，最大 100MB",-1)])]),default:t(()=>[l(p,{type:"primary"},{default:t(()=>[...e[11]||(e[11]=[n("选择文件",-1)])]),_:1})]),_:1},512)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(B,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=o=>C.value=o),title:"战利品详情",width:"600px"},{default:t(()=>[u.value?(s(),v(O,{key:0,column:1,border:""},{default:t(()=>[l(c,{label:"上交ID"},{default:t(()=>[n(r(u.value.id),1)]),_:1}),l(c,{label:"部落"},{default:t(()=>[n(r(u.value.teamName),1)]),_:1}),l(c,{label:"描述"},{default:t(()=>[n(r(u.value.description||"无"),1)]),_:1}),l(c,{label:"上交时间"},{default:t(()=>[n(r(N(u.value.createTime)),1)]),_:1}),l(c,{label:"评分"},{default:t(()=>[u.value.score!=null?(s(),v(M,{key:0,type:"success"},{default:t(()=>[n(r(u.value.score),1)]),_:1})):(s(),y("span",de,"待萨满鉴定"))]),_:1}),u.value.comment?(s(),v(c,{key:0,label:"萨满评语"},{default:t(()=>[n(r(u.value.comment),1)]),_:1})):k("",!0)]),_:1})):k("",!0)]),_:1},8,["modelValue"])])}}},be=Q(re,[["__scopeId","data-v-d638ca2d"]]);export{be as default};
