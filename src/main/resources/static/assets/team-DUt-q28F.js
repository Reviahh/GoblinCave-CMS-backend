import{y as s,a1 as o}from"./index-LBqe1eNs.js";function l(t){return s.get("/team/detail",{params:{teamId:t}})}function c(t){return s.post("/team/add",t)}function h(t){return s.post("/team/join",null,{params:{teamId:t}})}function m(t){return s.post("/team/quit",null,{params:{teamId:t}})}function u(t){return s.get("/team/list",{params:t})}function d(){return s.get("/team/list/my")}function f(t){return s.post("/team/update",t)}function y(t){return s.post("/team/delete",null,{params:{id:t}})}const p=o("team",{state:()=>({teams:[],currentTeam:null,loading:!1,error:null}),getters:{getTeamsByCompetition:t=>e=>t.teams.filter(r=>r.competitionId===e),getMyTeams:t=>e=>t.teams.filter(r=>r.userId===e)},actions:{clearError(){this.error=null},async fetchTeams(t){this.loading=!0,this.error=null;try{const r=(await u({competitionId:t}))?.data?.data;return Array.isArray(r)?this.teams=r:r?.list&&(this.teams=r.list),this.teams}catch(e){return console.error("fetchTeams error",e),this.error=e?.message||"获取队伍列表失败",[]}finally{this.loading=!1}},async fetchMyTeams(){this.loading=!0,this.error=null;try{const e=(await d())?.data?.data;let r=[];return Array.isArray(e)?r=e:e?.list&&(r=e.list),r.forEach(a=>{const i=this.teams.findIndex(n=>n.id===a.id);i!==-1?this.teams[i]=a:this.teams.push(a)}),r}catch(t){return console.error("fetchMyTeams error",t),[]}finally{this.loading=!1}},async fetchTeamDetail(t){this.loading=!0,this.error=null;try{const r=(await l(t))?.data?.data;this.currentTeam=r;const a=this.teams.findIndex(i=>i.id===t);return a!==-1?this.teams[a]=r:this.teams.push(r),r}catch(e){return console.error("fetchTeamDetail error",e),this.error=e?.message||"获取队伍详情失败",null}finally{this.loading=!1}},async createTeam(t){this.loading=!0,this.error=null;try{const e=await c(t),r=e?.data?.data;if(r)try{const a=await this.fetchTeamDetail(r);a&&!this.teams.find(i=>i.id===r)&&this.teams.push(a)}catch(a){console.warn("获取新建队伍详情失败",a)}return e}catch(e){throw console.error("createTeam error",e),this.error=e?.message||"创建队伍失败",e}finally{this.loading=!1}},async updateTeam(t){this.loading=!0,this.error=null;try{const e=await f(t),r=this.teams.findIndex(a=>a.id===t.id);return r!==-1&&(this.teams[r]={...this.teams[r],...t}),e}catch(e){throw console.error("updateTeam error",e),this.error=e?.message||"更新队伍失败",e}finally{this.loading=!1}},async dissolveTeam(t){this.loading=!0,this.error=null;try{const e=await y(t);return this.teams=this.teams.filter(r=>r.id!==t),e}catch(e){throw console.error("dissolveTeam error",e),this.error=e?.message||"解散队伍失败",e}finally{this.loading=!1}},async joinTeam(t){this.loading=!0,this.error=null;try{const e=await h(t);return await this.fetchTeamDetail(t),e}catch(e){throw console.error("joinTeam error",e),this.error=e?.message||"加入队伍失败",e}finally{this.loading=!1}},async quitTeam(t){this.loading=!0,this.error=null;try{const e=await m({teamId:t});return await this.fetchTeamDetail(t),e}catch(e){throw console.error("quitTeam error",e),this.error=e?.message||"退出队伍失败",e}finally{this.loading=!1}}},persist:!0}),T=Object.freeze(Object.defineProperty({__proto__:null,useTeamStore:p},Symbol.toStringTag,{value:"Module"}));export{l as g,T as t,p as u};
