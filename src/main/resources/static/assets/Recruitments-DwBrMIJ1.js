import{_ as H,r as v,c as j,o as G,D as J,d as i,e as n,l as s,m as g,A as y,f as a,w as o,g as r,F as x,v as h,u as K,q as b,t as d,i as m,B as O,$ as Q,a0 as W,E as q}from"./index-LBqe1eNs.js";import{useRecruitmentStore as X}from"./recruitment-BogGKxph.js";import{useCompetitionStore as Y}from"./competition-BeX1I71u.js";import"./competition-DDRzTI-D.js";const Z={class:"page"},ee={class:"filter-bar"},te={class:"recruitment-list"},le=["onClick"],ae={class:"card-header"},oe={class:"card-title"},ne={class:"card-content"},ue={class:"card-footer"},se={class:"card-meta"},re={key:0},ie={key:0,class:"card-tags"},de={key:1,class:"loading-tip"},me={__name:"Recruitments",setup(ce){const R=K(),c=J(),I=X(),k=Y(),V=v(!1),w=v(!1),p=v(!1),_=v(null),l=v({competitionId:null,teamId:null,title:"",content:"",maxMembers:2,tagsInput:""}),$=j(()=>_.value?I.recruitments.filter(u=>u.competitionId===_.value):I.recruitments);G(async()=>{c.query.competitionId&&(_.value=Number(c.query.competitionId),l.value.competitionId=Number(c.query.competitionId)),c.query.teamId&&(l.value.teamId=Number(c.query.teamId)),c.query.action==="create"&&(p.value=!0),V.value=!0;try{await Promise.all([I.fetchList(),k.fetchList()])}finally{V.value=!1}});function E(u){R.push(`/recruitments/${u}`)}function F(u){if(!u)return"";const t=new Date(u);return`${t.getMonth()+1}/${t.getDate()} ${t.getHours()}:${String(t.getMinutes()).padStart(2,"0")}`}async function L(){if(!l.value.competitionId||!l.value.title){q.warning("请填写试炼和标题");return}w.value=!0;try{const u=l.value.tagsInput?l.value.tagsInput.split(/[,，]/).map(t=>t.trim()).filter(Boolean):[];await I.create({competitionId:l.value.competitionId,teamId:l.value.teamId,title:l.value.title,content:l.value.content,maxMembers:l.value.maxMembers,tags:u}),q.success("发布成功"),p.value=!1,l.value={competitionId:null,teamId:null,title:"",content:"",maxMembers:2,tagsInput:""}}catch(u){q.error("发布失败："+(u?.message||"未知错误"))}finally{w.value=!1}}return(u,t)=>{const S=r("el-option"),U=r("el-select"),B=r("el-tag"),M=r("el-icon"),z=r("el-empty"),f=r("el-form-item"),C=r("el-input"),A=r("el-input-number"),P=r("el-form"),D=r("el-button"),T=r("el-dialog");return n(),i("div",Z,[t[10]||(t[10]=s("div",{class:"page-header"},[s("h2",null,"部落招募")],-1)),s("div",ee,[a(U,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=e=>_.value=e),placeholder:"按试炼筛选",clearable:"",style:{width:"200px"}},{default:o(()=>[(n(!0),i(x,null,h(b(k).competitions,e=>(n(),g(S,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),s("div",te,[(n(!0),i(x,null,h($.value,e=>(n(),i("div",{key:e.id,class:"recruitment-card",onClick:N=>E(e.id)},[s("div",ae,[s("h3",oe,d(e.title),1),e.competitionName?(n(),g(B,{key:0,size:"small",type:"primary"},{default:o(()=>[m(d(e.competitionName),1)]),_:2},1024)):y("",!0)]),s("p",ne,d(e.content),1),s("div",ue,[s("div",se,[s("span",null,[a(M,null,{default:o(()=>[a(b(O))]),_:1}),m(" "+d(e.authorName||e.author),1)]),s("span",null,[a(M,null,{default:o(()=>[a(b(Q))]),_:1}),m(" "+d(F(e.createdAt)),1)]),e.maxMembers?(n(),i("span",re,[a(M,null,{default:o(()=>[a(b(W))]),_:1}),m(" 招募 "+d(e.maxMembers)+" 只",1)])):y("",!0)]),e.tags?.length?(n(),i("div",ie,[(n(!0),i(x,null,h(e.tags,N=>(n(),g(B,{key:N,size:"small",type:"info"},{default:o(()=>[m(d(N),1)]),_:2},1024))),128))])):y("",!0)])],8,le))),128))]),!V.value&&$.value.length===0?(n(),g(z,{key:0,description:"暂无招募令"})):y("",!0),V.value?(n(),i("div",de,"加载中...")):y("",!0),a(T,{modelValue:p.value,"onUpdate:modelValue":t[7]||(t[7]=e=>p.value=e),title:"发布招募令",width:"600px"},{footer:o(()=>[a(D,{onClick:t[6]||(t[6]=e=>p.value=!1)},{default:o(()=>[...t[8]||(t[8]=[m("取消",-1)])]),_:1}),a(D,{type:"primary",onClick:L,loading:w.value},{default:o(()=>[...t[9]||(t[9]=[m("发布",-1)])]),_:1},8,["loading"])]),default:o(()=>[a(P,{model:l.value,"label-width":"100px"},{default:o(()=>[a(f,{label:"选择试炼",required:""},{default:o(()=>[a(U,{modelValue:l.value.competitionId,"onUpdate:modelValue":t[1]||(t[1]=e=>l.value.competitionId=e),placeholder:"请选择试炼",style:{width:"100%"}},{default:o(()=>[(n(!0),i(x,null,h(b(k).competitions,e=>(n(),g(S,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"标题",required:""},{default:o(()=>[a(C,{modelValue:l.value.title,"onUpdate:modelValue":t[2]||(t[2]=e=>l.value.title=e),placeholder:"例如：狩猎试炼找战友（擅长Python）"},null,8,["modelValue"])]),_:1}),a(f,{label:"招募需求"},{default:o(()=>[a(A,{modelValue:l.value.maxMembers,"onUpdate:modelValue":t[3]||(t[3]=e=>l.value.maxMembers=e),min:1,max:10},null,8,["modelValue"])]),_:1}),a(f,{label:"详细法则"},{default:o(()=>[a(C,{modelValue:l.value.content,"onUpdate:modelValue":t[4]||(t[4]=e=>l.value.content=e),type:"textarea",rows:4,placeholder:"描述你的需求、擅长领域、时间安排等（哥布林语）"},null,8,["modelValue"])]),_:1}),a(f,{label:"标签"},{default:o(()=>[a(C,{modelValue:l.value.tagsInput,"onUpdate:modelValue":t[5]||(t[5]=e=>l.value.tagsInput=e),placeholder:"用逗号分隔，如：编程,写作,建模"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ge=H(me,[["__scopeId","data-v-fc2a070c"]]);export{ge as default};
