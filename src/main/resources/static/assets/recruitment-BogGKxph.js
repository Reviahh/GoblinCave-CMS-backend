import{y as i,a1 as l}from"./index-LBqe1eNs.js";function m(e){return i.post("/recruitment/create",e)}function c(e){return i.post("/recruitment/update",e)}function h(e){return i.post("/recruitment/delete",null,{params:{id:e}})}function a(e){return i.post("/recruitment/list",e)}function u(e){return i.get("/recruitment/detail",{params:{id:e}})}const f=l("recruitment",{state:()=>({recruitments:[],myRecruitments:[],currentRecruitment:null,loading:!1,total:0}),actions:{async fetchList(e={pageNum:1,pageSize:20}){this.loading=!0;try{const r=(await a(e))?.data?.data;return Array.isArray(r)?this.recruitments=r:r?.list&&(this.recruitments=r.list,this.total=r.total||r.list.length),this.recruitments}catch(t){return console.error("fetchRecruitments error",t),[]}finally{this.loading=!1}},async fetchDetail(e){this.loading=!0;try{const t=await u(e),r=t?.data?.data||t?.data;return this.currentRecruitment=r,r}catch(t){return console.error("fetchRecruitmentDetail error",t),null}finally{this.loading=!1}},async create(e){try{const t=await m(e),r=t?.data?.data||{...e,id:Date.now()};return this.recruitments.unshift(r),t}catch(t){throw console.error("createRecruitment error",t),t}},async update(e,t){try{const r=await c({id:e,...t}),s=this.recruitments.findIndex(n=>n.id===e);return s!==-1&&(this.recruitments[s]={...this.recruitments[s],...t}),r}catch(r){throw console.error("updateRecruitment error",r),r}},async delete(e){try{const t=await h(e);return this.recruitments=this.recruitments.filter(r=>r.id!==e),t}catch(t){throw console.error("deleteRecruitment error",t),t}},async fetchMyRecruitments(){this.loading=!0;try{const t=(await a({isMyOwn:!0}))?.data?.data;return Array.isArray(t)?this.myRecruitments=t:t?.list&&(this.myRecruitments=t.list),this.myRecruitments||[]}catch(e){return console.error("fetchMyRecruitments error",e),[]}finally{this.loading=!1}},async closeRecruitment(e){try{const t=await c({id:e,status:2}),r=this.recruitments.findIndex(s=>s.id===e);if(r!==-1&&(this.recruitments[r].status=2),this.myRecruitments){const s=this.myRecruitments.findIndex(n=>n.id===e);s!==-1&&(this.myRecruitments[s].status=2)}return t}catch(t){throw console.error("closeRecruitment error",t),t}},async autoRegisterIfFull(e,t){try{const s=(await u(e))?.data?.data;if(!s)return!1;const n=(s.members||[]).length+1,o=s.maxMembers||5;return n>=o}catch(r){return console.error("autoRegisterIfFull error",r),!1}}},persist:!0});export{f as useRecruitmentStore};
