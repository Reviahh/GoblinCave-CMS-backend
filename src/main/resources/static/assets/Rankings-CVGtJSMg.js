import{_ as $,z as A,c as g,D as I,r as S,o as j,d as u,e as i,f as s,l as t,w as r,q as k,u as q,g as d,m as x,A as b,t as o,i as _,a3 as H,a7 as U,Z,E as C}from"./index-LBqe1eNs.js";import{u as F}from"./submission-C873XoBW.js";import"./submission-DCFVV_C6.js";const G={class:"page"},J={class:"page-header"},K={key:0,class:"loading-tip"},L={key:1,class:"ranking-container"},O={key:0,class:"top-three"},P={class:"rank-card silver"},Q={class:"rank-team"},W={class:"rank-score"},X={class:"rank-card gold"},Y={class:"rank-team"},ee={class:"rank-score"},te={class:"rank-card bronze"},se={class:"rank-team"},ae={class:"rank-score"},oe={class:"score"},ne={__name:"Rankings",setup(le){const R=I(),z=q(),m=F(),h=A(),p=g(()=>Number(R.params.competitionId)),v=S(!1),f=S(!1),n=g(()=>m.rankings),B=g(()=>h.role==="admin"||h.role===1);j(async()=>{if(p.value){v.value=!0;try{await m.fetchRankings(p.value)}finally{v.value=!1}}});function D(l){if(!l)return"";const e=new Date(l);return`${e.getMonth()+1}/${e.getDate()} ${e.getHours()}:${String(e.getMinutes()).padStart(2,"0")}`}function E(l){return l===1?"gold":l===2?"silver":l===3?"bronze":""}async function M(){f.value=!0;try{await m.exportScores(p.value),C.success("导出成功")}catch(l){C.error("导出失败："+(l?.message||"未知错误"))}finally{f.value=!1}}return(l,e)=>{const y=d("el-icon"),w=d("el-button"),c=d("el-table-column"),T=d("el-table"),V=d("el-empty");return i(),u("div",G,[s(w,{onClick:e[0]||(e[0]=a=>k(z).back()),type:"text",class:"back-btn"},{default:r(()=>[s(y,null,{default:r(()=>[s(k(H))]),_:1}),e[1]||(e[1]=_(" 返回试炼 ",-1))]),_:1}),t("div",J,[e[3]||(e[3]=t("h2",null,"试炼战力榜",-1)),B.value?(i(),x(w,{key:0,type:"success",onClick:M,loading:f.value},{default:r(()=>[s(y,null,{default:r(()=>[s(k(U))]),_:1}),e[2]||(e[2]=_(" 导出战绩 ",-1))]),_:1},8,["loading"])):b("",!0)]),v.value?(i(),u("div",K,"加载中...")):(i(),u("div",L,[n.value.length>=3?(i(),u("div",O,[t("div",P,[e[4]||(e[4]=t("div",{class:"rank-badge"},"2",-1)),t("div",Q,o(n.value[1]?.teamName),1),t("div",W,o(n.value[1]?.score)+" 分",1)]),t("div",X,[e[5]||(e[5]=t("div",{class:"rank-badge"},"1",-1)),t("div",Y,o(n.value[0]?.teamName),1),t("div",ee,o(n.value[0]?.score)+" 分",1)]),t("div",te,[e[6]||(e[6]=t("div",{class:"rank-badge"},"3",-1)),t("div",se,o(n.value[2]?.teamName),1),t("div",ae,o(n.value[2]?.score)+" 分",1)])])):b("",!0),s(T,{data:n.value,style:{width:"100%"},class:"ranking-table"},{default:r(()=>[s(c,{label:"排名",width:"80"},{default:r(({$index:a})=>[t("div",{class:Z(["rank-num",E(a+1)])},o(a+1),3)]),_:1}),s(c,{prop:"teamName",label:"部落名称"}),s(c,{label:"部下","show-overflow-tooltip":""},{default:r(({row:a})=>[_(o(a.members?.map(N=>N.userName||N.name).join("、")||"-"),1)]),_:1}),s(c,{prop:"score",label:"战力值",width:"120"},{default:r(({row:a})=>[t("span",oe,o(a.score??"-"),1)]),_:1}),s(c,{prop:"submitTime",label:"上交时间",width:"160"},{default:r(({row:a})=>[_(o(D(a.submitTime||a.createdAt)),1)]),_:1})]),_:1},8,["data"]),n.value.length===0?(i(),x(V,{key:1,description:"暂无战力数据"})):b("",!0)]))])}}},de=$(ne,[["__scopeId","data-v-2677b127"]]);export{de as default};
