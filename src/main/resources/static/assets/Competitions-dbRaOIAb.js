import{_ as T,z as E,r as N,c as V,o as b,d as r,e as o,l as n,m as c,A as u,F as w,v as D,q as v,u as A,g as p,t as m,w as i,i as l,f as g,B as F,C as I,x as L,E as C}from"./index-LBqe1eNs.js";import{useCompetitionStore as q}from"./competition-BeX1I71u.js";import"./competition-DDRzTI-D.js";const R={class:"page"},U={class:"competition-list"},j=["onClick"],G={class:"card-header"},H={class:"card-title"},J={class:"header-right"},K={class:"card-summary"},O={class:"card-footer"},P={class:"card-meta"},Q={key:0,class:"loading-tip"},W={__name:"Competitions",setup(X){const z=A(),d=q(),h=E(),_=N(!1),x=V(()=>{const s=h.role;return s==="admin"||s===1||s==="1"}),B=s=>s.creatorId==h.id;b(()=>{_.value=!0,d.fetchList().catch(()=>{}).finally(()=>{_.value=!1})});function f(s){z.push(`/competitions/${s}`)}async function M(s,e){try{await L.confirm(`确定要删除竞赛 "${e}" 吗？删除后相关的招募、队伍、报名等数据也将被清理。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"});const a=C({message:"正在删除竞赛及相关数据...",type:"info",duration:0});await d.deleteCompetition(s),a.close(),C.success("删除成功，已自动刷新数据")}catch(a){a!=="cancel"&&(console.error("删除失败",a),C.error("删除失败："+(a?.message||"未知错误")))}}return(s,e)=>{const a=p("el-tag"),$=p("el-icon"),y=p("el-button"),S=p("el-empty");return o(),r("div",R,[e[5]||(e[5]=n("h2",null,"部落试炼列表",-1)),n("div",U,[(o(!0),r(w,null,D(v(d).competitions,t=>(o(),r("div",{key:t.id,class:"competition-card",onClick:k=>f(t.id)},[n("div",G,[n("h3",H,m(t.name),1),n("div",J,[t.endTime?(o(),c(a,{key:0,size:"small",type:"info"},{default:i(()=>[l(" 截止："+m(t.endTime),1)]),_:2},1024)):u("",!0),x.value&&B(t)?(o(),c(a,{key:1,size:"small",type:"success"},{default:i(()=>[...e[1]||(e[1]=[l(" 我发布的 ",-1)])]),_:1})):u("",!0)])]),n("p",K,m(t.summary||"暂无简介"),1),n("div",O,[n("span",P,[g($,null,{default:i(()=>[g(v(F))]),_:1}),l(" 哥布林数量上限："+m(t.maxMembers??5),1)]),n("div",{class:"card-actions",onClick:e[0]||(e[0]=I(()=>{},["stop"]))},[x.value?(o(),r(w,{key:0},[g(y,{type:"primary",size:"small",onClick:k=>f(t.id)},{default:i(()=>[...e[2]||(e[2]=[l(" 详情 ",-1)])]),_:1},8,["onClick"]),B(t)?(o(),c(y,{key:0,type:"danger",size:"small",onClick:k=>M(t.id,t.name)},{default:i(()=>[...e[3]||(e[3]=[l(" 删除 ",-1)])]),_:1},8,["onClick"])):u("",!0)],64)):(o(),c(y,{key:1,type:"primary",size:"small",onClick:k=>f(t.id)},{default:i(()=>[...e[4]||(e[4]=[l(" 查看详情 ",-1)])]),_:1},8,["onClick"]))])])],8,j))),128))]),_.value?(o(),r("div",Q,"加载中...")):v(d).competitions.length===0?(o(),c(S,{key:1,description:"暂无试炼"})):u("",!0)])}}},te=T(W,[["__scopeId","data-v-1d9f0824"]]);export{te as default};
