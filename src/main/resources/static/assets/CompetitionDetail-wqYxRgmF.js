import{_ as re,z as me,r as C,D as ce,o as pe,c as S,d as u,e as s,l as i,A as h,t as k,f as t,i as d,w as a,g as p,q as x,m as j,u as ve,G as fe,B as _e,H as P,F as Q,v as W,E as v,x as ye}from"./index-LBqe1eNs.js";import{useCompetitionStore as be}from"./competition-BeX1I71u.js";import{u as ge}from"./team-DUt-q28F.js";import{useRecruitmentStore as ke}from"./recruitment-BogGKxph.js";import{getMyRegistrationStatus as xe,registerCompetition as we}from"./competition-DDRzTI-D.js";import{a as he,b as Ve}from"./style-D2LCvmlZ.js";const Ie={class:"competition-detail-page"},Ce={class:"markdown-body"},Te={class:"article-header"},Me={class:"article-meta"},Se={key:0},Ne={key:0,class:"article-summary"},Re={key:1,class:"article-content"},Ue={key:2,class:"article-content empty-content"},De={key:0,class:"action-section"},je={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Be={key:0},$e={key:1},qe={key:2},ze={class:"action-buttons"},Ee={key:1,class:"mode-tip"},Fe={key:2,class:"mode-tip"},Le={class:"seek-section"},Ae={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px"}},Ge={key:3,class:"form-section"},He={key:4,class:"form-section"},Je={key:5,class:"form-section"},Ke={key:0,class:"my-team-entry"},Oe={style:{"margin-top":"6px"}},Pe={key:1,class:"team-hint"},Qe={key:1,class:"action-section"},We={class:"action-buttons"},Xe={class:"form-section"},Ye={class:"editor-container"},Ze={class:"team-section"},X="github",Y="github",et={__name:"CompetitionDetail",setup(tt){const B=ce(),N=ve(),_=me(),$=be(),b=ge(),F=ke(),o=C($.competitions.find(l=>l.id==B.params.id)||{id:Date.now(),name:"æœªæ‰¾åˆ°",summary:"",maxMembers:5}),r=C(null),q=C(!1);async function R(){if(!(!_.id||!o.value.id))try{const l=await xe(o.value.id,{silent:!0});console.log("Registration status response:",l);const e=l?.data?.data?.status??null;r.value=e,console.log("Registration status set to:",r.value)}catch(l){console.debug("è·å–æŠ¥åçŠ¶æ€å¤±è´¥:",l.message),r.value=null}}pe(async()=>{const l=B.params.id;if(l){const e=await $.fetchCompetition(Number(l));e&&(o.value=e),b.fetchTeams(Number(l)),F.fetchList({competitionId:Number(l)}),_.role==="student"&&await R()}});function Z(){return{0:"ç­‰å¾…å®¡æ ¸ä¸­",1:"æŠ¥åå·²é€šè¿‡",2:"æŠ¥åæœªé€šè¿‡"}[r.value]||"æœªæŠ¥å"}async function ee(){q.value=!0;try{await R(),v.success("çŠ¶æ€å·²åˆ·æ–°")}catch{v.error("åˆ·æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{q.value=!1}}const L=C(B.query.mode==="join"?"join":"create"),T=S(()=>(o.value.maxMembers??5)===1),f=C({name:"",leaderId:_.username,members:[]}),A=S(()=>(F.recruitments||[]).filter(l=>l.competitionId==o.value.id)),G=S(()=>b.teams.filter(l=>l.competitionId==o.value.id)),H=S(()=>G.value.filter(l=>(l.currentNum||1)<(l.maxNum||o.value.maxMembers||5))),U=C(null);function te(l){const e=l.currentNum||1+(l.members?.length||0),g=l.maxNum||o.value.maxMembers||5;return`ï¼ˆ${e}/${g}ï¼‰`}async function J(){if(r.value===0||r.value===1){v.warning("æ‚¨å·²æŠ¥åè¯¥ç«èµ›ï¼Œæ— éœ€é‡å¤æŠ¥å");return}try{if(!T.value&&b.teams.some(V=>V.competitionId==o.value.id&&(V.userId===_.id||(V.members||[]).some(y=>y.userId===_.id)))){v.info("ä½ å·²åœ¨è¯¥ç«èµ›çš„é˜Ÿä¼ä¸­");return}let l,e;if(T.value)l=`${_.name||_.username||"ä¸ªäººå‚èµ›è€…"}çš„ä¸ªäººé˜Ÿä¼`,e="ä¸ªäººå‚èµ›";else{if(l=f.value.name,!l)return v.warning("è¯·è¾“å…¥é˜Ÿä¼åç§°");e=f.value.description||"æŠ¥åå‚èµ›"}const g=await b.createTeam({competitionId:o.value.id,name:l,description:e}),w=g?.data?.data;if(console.log("Team response:",g),console.log("Team ID:",w),!w)throw new Error("é˜Ÿä¼åˆ›å»ºå¤±è´¥ï¼šåç«¯æœªè¿”å›é˜Ÿä¼ID");await we({competitionId:o.value.id,teamId:w}),v.success("æŠ¥åæˆåŠŸï¼è¯·ç­‰å¾…å®¡æ ¸"),await b.fetchTeams(o.value.id),await R(),T.value||ye.confirm("é˜Ÿä¼åˆ›å»ºæˆåŠŸï¼æ˜¯å¦ç«‹å³å‘å¸ƒæ‹›å‹Ÿå¸–å¯»æ‰¾é˜Ÿå‹ï¼Ÿ","æç¤º",{confirmButtonText:"å»å‘å¸ƒ",cancelButtonText:"æš‚ä¸éœ€è¦",type:"success"}).then(()=>{console.log("Navigating with teamId:",w),N.push({path:"/recruitments",query:{competitionId:o.value.id,teamId:String(w),action:"create"}})}).catch(()=>{})}catch(l){console.error("æŠ¥åå¤±è´¥:",l);const e=l.response?.data?.message||l.message||"æœªçŸ¥é”™è¯¯";e.includes("å·²æŠ¥å")||e.includes("é‡å¤")||e.includes("å‚æ•°é”™è¯¯")?(v.warning("æ‚¨ä¼¼ä¹å·²ç»æŠ¥åè¿‡äº†ï¼Œæ­£åœ¨åˆ·æ–°çŠ¶æ€..."),await R()):v.error("æ“ä½œå¤±è´¥ï¼š"+e)}}async function le(){const l=U.value;if(l)try{await b.joinTeam(l),v.success("åŠ å…¥æˆåŠŸ"),b.fetchTeams(o.value.id)}catch(e){v.error("åŠ å…¥å¤±è´¥ï¼š"+(e.message||"æœªçŸ¥é”™è¯¯"))}}function ae(){$.updateCompetition(o.value.id,{name:o.value.name,summary:o.value.summary,content:o.value.content,maxMembers:o.value.maxMembers}),v.success("ç«èµ›ä¿¡æ¯å·²æ›´æ–°")}async function oe(l){try{await b.dissolveTeam(l),v.success("é˜Ÿä¼å·²è§£æ•£")}catch{v.error("åˆ é™¤å¤±è´¥")}}function K(l){N.push({path:"/team-detail",query:{teamId:l}})}const z=S(()=>G.value.find(l=>l.userId===_.id||(l.members||[]).some(e=>e.userId===_.id)));function E(){N.push({path:"/recruitments",query:{competitionId:o.value.id}})}function ne(l){N.push("/recruitments/"+l)}return(l,e)=>{const g=p("el-icon"),w=p("el-divider"),m=p("el-button"),V=p("el-alert"),y=p("el-table-column"),O=p("el-table"),se=p("el-empty"),I=p("el-input"),c=p("el-form-item"),D=p("el-form"),ie=p("el-option"),ue=p("el-select"),de=p("el-input-number");return s(),u("div",Ie,[i("article",Ce,[i("header",Te,[i("h1",null,k(o.value.name),1),i("div",Me,[o.value.endTime?(s(),u("span",Se,[t(g,null,{default:a(()=>[t(x(fe))]),_:1}),d(" æˆªæ­¢æ—¶é—´ï¼š"+k(o.value.endTime),1)])):h("",!0),i("span",null,[t(g,null,{default:a(()=>[t(x(_e))]),_:1}),d(" äººæ•°ä¸Šé™ï¼š"+k(o.value.maxMembers??5),1)])])]),o.value.summary?(s(),u("section",Ne,[i("blockquote",null,k(o.value.summary),1)])):h("",!0),o.value.content?(s(),u("section",Re,[t(x(he),{modelValue:o.value.content,theme:X,codeTheme:Y},null,8,["modelValue"])])):(s(),u("section",Ue,[...e[10]||(e[10]=[i("p",null,"æš‚æ— è¯¦ç»†å†…å®¹",-1)])]))]),x(_).role==="student"?(s(),u("div",De,[t(w),r.value!==null?(s(),j(V,{key:0,type:r.value===1?"success":r.value===0?"warning":"error",title:Z(),closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},{default:a(()=>[i("div",je,[i("div",null,[r.value===0?(s(),u("div",Be," æ‚¨çš„æŠ¥åç”³è¯·æ­£åœ¨å®¡æ ¸ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…è¨æ»¡å“¥å¸ƒæ—å®¡æ ¸... ")):r.value===1?(s(),u("div",$e," æ­å–œï¼æ‚¨çš„æŠ¥åå·²é€šè¿‡å®¡æ ¸ï¼Œå¯ä»¥å¼€å§‹å‡†å¤‡æ¯”èµ›äº† ğŸ‰ ")):r.value===2?(s(),u("div",qe," å¾ˆæŠ±æ­‰ï¼Œæ‚¨çš„æŠ¥åæœªé€šè¿‡å®¡æ ¸ï¼Œè¯·è”ç³»è¨æ»¡å“¥å¸ƒæ—äº†è§£è¯¦æƒ… ")):h("",!0)]),t(m,{size:"small",onClick:ee,loading:q.value},{default:a(()=>[...e[11]||(e[11]=[d(" åˆ·æ–°çŠ¶æ€ ",-1)])]),_:1},8,["loading"])])]),_:1},8,["type","title"])):h("",!0),e[22]||(e[22]=i("h3",null,"æŠ¥åå‚æˆ˜",-1)),i("div",ze,[t(m,{type:"primary",onClick:E},{default:a(()=>[t(g,null,{default:a(()=>[t(x(P))]),_:1}),e[12]||(e[12]=d(" å‘èµ·ä¸´æ—¶ä¼šè¯ï¼ˆå¯»æ‰¾æˆ˜å‹ï¼‰ ",-1))]),_:1})]),T.value?(s(),u("p",Ee,[...e[13]||(e[13]=[d(" å½“å‰æ¨¡å¼ï¼š",-1),i("strong",null,"å•äººè¯•ç‚¼ï¼ˆç›´æ¥æŠ¥åï¼‰",-1)])])):(s(),u("p",Fe,[e[14]||(e[14]=d(" å½“å‰æ¨¡å¼ï¼š ",-1)),i("strong",null,k(L.value==="join"?"å‚åŠ ï¼ˆéƒ¨ä¸‹ï¼‰":"æŠ¥åï¼ˆé…‹é•¿ï¼‰"),1)])),i("div",Le,[i("div",Ae,[e[16]||(e[16]=i("h4",{style:{margin:"0"}},"è¯¥ç«èµ›çš„æ‹›å‹Ÿä»¤",-1)),t(m,{link:"",type:"primary",onClick:E},{default:a(()=>[...e[15]||(e[15]=[d("æŸ¥çœ‹æ›´å¤š / å‘å¸ƒæ‹›å‹Ÿ",-1)])]),_:1})]),A.value.length?(s(),j(O,{key:0,data:A.value,border:"",stripe:""},{default:a(()=>[t(y,{prop:"title",label:"æ ‡é¢˜","min-width":"200","show-overflow-tooltip":""}),t(y,{label:"å‘å¸ƒå“¥å¸ƒæ—",width:"120"},{default:a(({row:n})=>[d(k(n.authorName||n.author),1)]),_:1}),t(y,{label:"å‰©ä½™åé¢",width:"100",align:"center"},{default:a(({row:n})=>[d(k(n.maxMembers?n.maxMembers+"åª":"ä¸é™"),1)]),_:1}),t(y,{label:"æ“ä½œ",width:"100",fixed:"right"},{default:a(({row:n})=>[t(m,{type:"primary",link:"",size:"small",onClick:M=>ne(n.id)},{default:a(()=>[...e[17]||(e[17]=[d("æŸ¥çœ‹è¯¦æƒ…",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(s(),j(se,{key:1,description:"æš‚æ— æ‹›å‹Ÿä»¤"}))]),T.value&&r.value===null?(s(),u("div",Ge,[t(D,{model:f.value,"label-width":"100px"},{default:a(()=>[t(c,{label:"éƒ¨è½åç§°"},{default:a(()=>[t(I,{modelValue:f.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>f.value.name=n),placeholder:"è¯·è¾“å…¥éƒ¨è½åç§°"},null,8,["modelValue"])]),_:1}),t(c,{label:"é…‹é•¿"},{default:a(()=>[t(I,{modelValue:f.value.leaderId,"onUpdate:modelValue":e[1]||(e[1]=n=>f.value.leaderId=n),disabled:""},null,8,["modelValue"])]),_:1}),t(c,null,{default:a(()=>[t(m,{type:"success",onClick:J},{default:a(()=>[...e[18]||(e[18]=[d(" ç«‹å³æŠ¥å ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])):L.value!=="join"&&r.value===null?(s(),u("div",He,[t(D,{model:f.value,"label-width":"100px"},{default:a(()=>[t(c,{label:"éƒ¨è½åç§°"},{default:a(()=>[t(I,{modelValue:f.value.name,"onUpdate:modelValue":e[2]||(e[2]=n=>f.value.name=n),placeholder:"è¯·è¾“å…¥éƒ¨è½åç§°"},null,8,["modelValue"])]),_:1}),t(c,{label:"é…‹é•¿"},{default:a(()=>[t(I,{modelValue:f.value.leaderId,"onUpdate:modelValue":e[3]||(e[3]=n=>f.value.leaderId=n),disabled:""},null,8,["modelValue"])]),_:1}),t(c,null,{default:a(()=>[t(m,{type:"success",onClick:J},{default:a(()=>[...e[19]||(e[19]=[d(" æäº¤æŠ¥å ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])):(s(),u("div",Je,[z.value?(s(),u("div",Ke,[t(V,{type:"info","show-icon":"",closable:!1,title:"ä½ å·²åœ¨è¯¥ç«èµ›çš„éƒ¨è½ä¸­"},{default:a(()=>[i("div",Oe,[d(" å½“å‰éƒ¨è½ï¼š"+k(z.value.name)+" ",1),t(m,{type:"primary",link:"",onClick:e[4]||(e[4]=n=>K(z.value.id))},{default:a(()=>[...e[20]||(e[20]=[d("ç®¡ç†æˆ‘çš„éƒ¨è½",-1)])]),_:1})])]),_:1})])):h("",!0),t(D,{"label-width":"120px"},{default:a(()=>[t(c,{label:"é€‰æ‹©éƒ¨è½"},{default:a(()=>[t(ue,{modelValue:U.value,"onUpdate:modelValue":e[5]||(e[5]=n=>U.value=n),placeholder:"è¯·é€‰æ‹©éƒ¨è½",style:{width:"260px"}},{default:a(()=>[(s(!0),u(Q,null,W(H.value,n=>(s(),j(ie,{key:n.id,label:n.name+te(n),value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,null,{default:a(()=>[t(m,{type:"primary",disabled:!U.value,onClick:le},{default:a(()=>[...e[21]||(e[21]=[d(" åŠ å…¥éƒ¨è½ ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),H.value.length===0?(s(),u("div",Pe,' æš‚æ— å¯åŠ å…¥éƒ¨è½ï¼Œè¯·è”ç³»é…‹é•¿æˆ–åˆ‡æ¢åˆ°"æŠ¥åï¼ˆé…‹é•¿ï¼‰"æ¨¡å¼åˆ›å»ºéƒ¨è½ã€‚ ')):h("",!0)]))])):x(_).role==="admin"?(s(),u("div",Qe,[t(w),e[29]||(e[29]=i("h3",null,"ç«èµ›ç»Ÿæ²»",-1)),i("div",We,[t(m,{type:"primary",onClick:E},{default:a(()=>[t(g,null,{default:a(()=>[t(x(P))]),_:1}),e[23]||(e[23]=d(" å‘èµ·ä¸´æ—¶ä¼šè¯ï¼ˆå¯»æ‰¾æˆ˜å‹ï¼‰ ",-1))]),_:1})]),i("div",Xe,[e[25]||(e[25]=i("h4",null,"ç¼–è¾‘ç«èµ›æƒ…æŠ¥",-1)),t(D,{model:o.value,"label-width":"100px"},{default:a(()=>[t(c,{label:"æ ‡é¢˜"},{default:a(()=>[t(I,{modelValue:o.value.name,"onUpdate:modelValue":e[6]||(e[6]=n=>o.value.name=n)},null,8,["modelValue"])]),_:1}),t(c,{label:"æè¿°"},{default:a(()=>[t(I,{modelValue:o.value.summary,"onUpdate:modelValue":e[7]||(e[7]=n=>o.value.summary=n),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),t(c,{label:"å†…å®¹"},{default:a(()=>[i("div",Ye,[t(x(Ve),{modelValue:o.value.content,"onUpdate:modelValue":e[8]||(e[8]=n=>o.value.content=n),theme:"light","preview-theme":X,"code-theme":Y},null,8,["modelValue"])])]),_:1}),t(c,{label:"å“¥å¸ƒæ—æ•°é‡é™åˆ¶"},{default:a(()=>[t(de,{modelValue:o.value.maxMembers,"onUpdate:modelValue":e[9]||(e[9]=n=>o.value.maxMembers=n),min:1},null,8,["modelValue"])]),_:1}),t(c,null,{default:a(()=>[t(m,{type:"primary",onClick:ae},{default:a(()=>[...e[24]||(e[24]=[d("ä¿å­˜ä¿®æ”¹",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),i("div",Ze,[e[28]||(e[28]=i("h4",null,"éƒ¨è½åˆ—è¡¨",-1)),t(O,{data:x(b).teams.filter(n=>n.compId===o.value.id),border:""},{default:a(()=>[t(y,{prop:"name",label:"éƒ¨è½åç§°"}),t(y,{prop:"leaderId",label:"é…‹é•¿"}),t(y,{label:"éƒ¨ä¸‹"},{default:a(({row:n})=>[(s(!0),u(Q,null,W(n.members,M=>(s(),u("span",{key:M.userId},k(M.userId),1))),128))]),_:1}),t(y,{label:"æ“ä½œ",width:"220"},{default:a(({row:n})=>[t(m,{type:"primary",size:"small",onClick:M=>K(n.id)},{default:a(()=>[...e[26]||(e[26]=[d("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),t(m,{type:"danger",size:"small",onClick:M=>oe(n.id)},{default:a(()=>[...e[27]||(e[27]=[d("è§£æ•£éƒ¨è½",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])])])):h("",!0)])}}},ut=re(et,[["__scopeId","data-v-b5280198"]]);export{ut as default};
