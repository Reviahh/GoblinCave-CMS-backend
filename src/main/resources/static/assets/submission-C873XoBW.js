import{a1 as a}from"./index-LBqe1eNs.js";import{downloadSubmission as c,getScoreDetail as l,exportScores as u,getCompetitionRank as d,scoreSubmission as m,submitWork as h,getSubmissionDetail as p,listSubmissions as f}from"./submission-DCFVV_C6.js";const g=a("submission",{state:()=>({submissions:[],currentSubmission:null,rankings:[],loading:!1,error:null,total:0}),getters:{getSubmissionsByCompetition:s=>t=>s.submissions.filter(e=>e.competitionId===t),getMySubmissions:s=>t=>s.submissions.filter(e=>e.userId===t)},actions:{async fetchList(s={}){this.loading=!0;try{const e=(await f(s))?.data?.data;return Array.isArray(e)?this.submissions=e:e?.list&&(this.submissions=e.list,this.total=e.total||e.list.length),this.submissions}catch(t){return console.error("fetchSubmissions error",t),[]}finally{this.loading=!1}},async fetchDetail(s){this.loading=!0;try{const t=await p(s),e=t?.data?.data||t?.data;return this.currentSubmission=e,e}catch(t){return console.error("fetchSubmissionDetail error",t),null}finally{this.loading=!1}},async submit(s){try{const t=new FormData;t.append("competitionId",s.competitionId),t.append("registrationId",s.registrationId),t.append("description",s.description||""),t.append("file",s.file);const e=await h(t);return s.competitionId&&await this.fetchList({competitionId:s.competitionId}),e}catch(t){throw console.error("submit error",t),t}},async score(s){this.loading=!0;try{const t=await m({submissionId:s.submissionId,score:s.score}),e=this.submissions.findIndex(r=>r.id===s.submissionId);return e!==-1&&(this.submissions[e].score=s.score,this.submissions[e].status=1),t}finally{this.loading=!1}},async fetchRankings(s){this.loading=!0;try{const t=await d(s),e=t?.data?.data||t?.data;return this.rankings=Array.isArray(e)?e:[],this.rankings}catch(t){return console.error("fetchRankings error",t),[]}finally{this.loading=!1}},async exportScores(s){try{const t=await u(s),e=new Blob([t.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),r=window.URL.createObjectURL(e),i=document.createElement("a");return i.href=r,i.download=`成绩表_${s}_${Date.now()}.xlsx`,i.click(),window.URL.revokeObjectURL(r),!0}catch(t){throw console.error("exportScores error",t),t}},async fetchScoreDetail(s){try{const t=await l(s);return t?.data?.data||t?.data}catch(t){return console.error("fetchScoreDetail error",t),null}},async downloadFile(s){try{const e=(await c(s)).data;if(e.type.includes("application/json")){const o=await e.text(),n=JSON.parse(o);throw new Error(n.message||"下载失败")}const r=window.URL.createObjectURL(e),i=document.createElement("a");i.href=r,i.download=`submission_${s}`,i.click(),window.URL.revokeObjectURL(r)}catch(t){throw console.error("download error",t),t}}},persist:!0});export{g as u};
